<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="prev" title="Relationale Datenbanken" href="10_Datenbanken.html" />
        <link rel="canonical" href="https://code-book.ai4sc-lehre.auf.uni-rostock.de/lectures/11_Datenbankentwurf.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Entwurf relationaler Datenbanken - Programmierung und Datenbanken</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d8a2add5" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=93caba0e" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  --color-brand-primary: #29465B;
  --color-brand-content: #29465B;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #98AFC7;
  --color-brand-content: #98AFC7;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #98AFC7;
  --color-brand-content: #98AFC7;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../intro.html"><div class="brand">Programmierung und Datenbanken</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../intro.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/ai4sc_logo_v2.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/ai4sc_logo_v2.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Programmierung und Datenbanken</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Grundlagen</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="01c_Computerhardware.html">Computerhardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="01d_Programmiersprachen.html">Programmiersprachen</a></li>
<li class="toctree-l1"><a class="reference internal" href="01e_Softwarearchitektur.html">Softwarearchitekturen</a></li>
<li class="toctree-l1"><a class="reference internal" href="02a_Wissenspyramide.html">Wissenspyramide</a></li>
<li class="toctree-l1"><a class="reference internal" href="02aq_Quiz_Wissenspyramide.html">Quiz: Wissenspyramide</a></li>
<li class="toctree-l1"><a class="reference internal" href="02b_Datentypen.html">Datentypen</a></li>
<li class="toctree-l1"><a class="reference internal" href="02bq_Quiz_Datentypen.html">Quiz: Datentypen</a></li>
<li class="toctree-l1"><a class="reference internal" href="02c_Operatoren.html">Operatoren</a></li>
<li class="toctree-l1"><a class="reference internal" href="02cq_Quiz_Logik.html">Quiz: Logische Operationen</a></li>
<li class="toctree-l1"><a class="reference internal" href="03a_Verzweigung.html">Verzweigungen</a></li>
<li class="toctree-l1"><a class="reference internal" href="03b_Schleifen.html">Schleifen</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modularisierung</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="04a_Funktionen.html">Funktionen</a></li>
<li class="toctree-l1"><a class="reference internal" href="04c_Objects.html">Objekte</a></li>
<li class="toctree-l1"><a class="reference internal" href="04b_Rekursion.html">Rekursive Funktionen</a></li>
<li class="toctree-l1"><a class="reference internal" href="05a_Programmablauf.html">Programmablauf</a></li>
<li class="toctree-l1"><a class="reference internal" href="05b_Algorithmen.html">Such- und Sortieralgorithmen</a></li>
<li class="toctree-l1"><a class="reference internal" href="06a_Exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="06b_UnitTest.html">Unit-Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="06c_Debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="07a_Module.html">Pakete</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Datenbanken</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="9_Datenhaltung.html">Umgang mit Dateien</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_Datenbanken.html">Relationale Datenbanken</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Entwurf relationaler Datenbanken</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/lectures/11_Datenbankentwurf.ipynb" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="entwurf-relationaler-datenbanken">
<h1>Entwurf relationaler Datenbanken<a class="headerlink" href="#entwurf-relationaler-datenbanken" title="Link to this heading">¶</a></h1>
<section id="entwurfsvorgehen">
<h2>Entwurfsvorgehen<a class="headerlink" href="#entwurfsvorgehen" title="Link to this heading">¶</a></h2>
<p>Das klassische Entwurfsvorgehen von Datenbanken ähnelt dem Wasserfallmodell beim Softwareentwurf. Hierbei werden zuerst die Anforderungen und Anwendungsfälle</p>
<ul class="simple">
<li><p>Anforderungsanalyse: Welche Anforderungen und Anwendungsfälle stellen sich an die DB?</p></li>
<li><p>Konzeptioneller Entwurf: Grobentwurf in dem im ER-Diagram die benötigten Entitäten, Attribute und Relationen abgebildet werden</p></li>
<li><p>Logischer Entwurf: Detailentwurf des konkreten Datenbankschematas für eine spezielles DBMS das die wirklichen Tabellen in der DB abbildet und normalisiert wird</p></li>
<li><p>Physikalischer Entwurf: Finale Festlegungen von Primärindexen und zusätzlicher Suchindexe zur Zugriffsoptimierung</p></li>
<li><p>Implementation und Test: Erstellung der Datenbank mit SQL</p></li>
<li><p>Einsatz und Wartung: Verwendung der Datenbank</p></li>
</ul>
<p>Entscheidend in dem Vorgehen ist, dass es mit dem Konzeptioneller Entwurf einen Grobentwurf gibt, in der die funktional notwendigen Entitäten entworfen werden und einen nachfolgenden Detailentwurf mit dem Logischen und Physikalischen Entwurf, in dem die eigentlichen Tabellen in einem DBMS abgeleitet werden, welche sich meist unterscheiden, wie nachfolgend dargestellt.</p>
<p><img alt="Schritte im Datenbankentwurf" src="../_images/dbentwurf.png" /></p>
</section>
<section id="er-diagramme">
<h2>ER-Diagramme<a class="headerlink" href="#er-diagramme" title="Link to this heading">¶</a></h2>
<p>Zur Darstellung der Entwürfe von Datenbanken nutzt man Entity-Relationship Diagramme. In ihnen visualisiert man die Entitäten mit Ihnen Attributen und die Relationen zwischen den Entitäten. Es gibt verschiedene varianten von ER-Diagrammen, wie in der folgenden Abbildung dargestellt. Gemein ist allen, dass sie Entitäten, Attribute (hier nicht dargestellt) und Relationen mit Kardinalitäten darstellen. Sie unterscheiden sich primär in der Notation, als im Gebrauch von Symbolen.</p>
<p><img alt="ER-Diagramme in unterschiedlichen Notationen (https://de.wikipedia.org/wiki/Datei:ERD_Darstellungen.png)" src="../_images/er-diagramme.png" /></p>
<p>Wir benutzen im Folgenden die UML-Notation, welche auf UML-Klassendiagrammen basiert.</p>
<p>Klassen erhalten die Anmerkung <code class="docutils literal notranslate"><span class="pre">&lt;&lt;Entity&gt;&gt;</span></code> um sie von normalen Klassen abzugrenzen</p>
<ul class="simple">
<li><p>Attribute (Tabellenspalten) werden als Klassenattribute mit ihrem Datentyp dargestellt</p></li>
<li><p>Primärschlüssel werden mit PK gekennzeichnet</p></li>
<li><p>Relationship-Attribute (Fremdschlüssel) werden mit Assoziationen modelliert</p></li>
<li><p>Die Leserichtung von Relationstypen wird mit <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> oder <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> angegeben</p></li>
<li><p>Zahlen an Relationships geben die Kardinalität an</p></li>
</ul>
<p>Ein wichtiger Unterschied zu UML-Diagrammen ist, dass es in ER-Diagrammen keine Methoden, Vererbung, Polymorphismus, Kapzelung, Klassenhierarchien gibt. Wir wenden also entsprechende Symbole nicht an.</p>
<p>Ein einfaches Beispiel stellt das folgende Bild dar. Wir haben eine Person, die in einem Ort wohnt. Die Person hat die Attribute Ausweisnummer und einen Namen. Wir nutzen die Ausweisnummer als Primärschlüssel, da sie eindeutig ist. Der Ort hat eine Postleitzahl und einen Namen. Die Postleitzahl dient hier als Primärschlüssel der einfachheit halber (Da eine Postleitzahl viele Gemeinden umfassen kann oder ein Ort mehrere Postleitzahlen haben kann ist dies nicht ideal). Als Relation kennzeichnen wir hier, dass eine Person in genau einem Ort wohnt. Zu beachten ist hier die Leserichtung <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> und die Kardinalitäten 1 zu 1 die am Anfang und Ende der Relation stehen.</p>
<center><img src="https://mermaid.ink/svg/pako:eNqNUEFqAzEM_IrROTn0akIg0FsLXZpb8UWslazBloMtE9Kwf8lb-rKKZk0p9BCYgzQeeYa5wpg9gYUxYq3PAY8Fk-Ovm1H4UGiUkNm8vnduoFKVcPDkwKzXy_BWxFhzzhOLCWy22y7_-XY5unbyjs2GWIJcfsV3VCmBj2bX6plC5ZYSFTO8_CtiTNQf5r-eGulBw6Chh1wlUpBPnOKDZrACTZYweK1PrYx2IROpBqyOng7YojhwPKsUm-T9hUewUhqtoJ08Ci2Fgz1grMqekD9y7vv8DX4bo1o" width="350"></center></section>
<section id="kardinalitaten">
<h2>Kardinalitäten<a class="headerlink" href="#kardinalitaten" title="Link to this heading">¶</a></h2>
<p>In ER-Diagrammen spielt dabei insbesondere die Kardinalität von Relationen eine wichtige Rolle, da sich daraus unterschiedliche Tabellendarstellungen ableiten. Die Kardinalitäten beschreiben die Anzahl an minimalen und maximalen möglichen Beziehungen zwischen Entitäten für diese Beziehung. Grundsätzlich unterscheidet man die folgenden Kardinalitäten:</p>
<table>
    <tr>
        <td style="width: 10%">Kardinalität</td>
        <td style="width: 40%">Beispiel</td>
        <td style="width: 50%">ER-Diagramm</td>
    </tr>
    <tr>
        <td>1 zu 1</td>
        <td>Eine Person ist geboren in minimal einem, maximal einem Ort.</td>
        <td><img src="https://mermaid.ink/svg/pako:eNqNjzEOwjAMRa8SeW4H1gh1YkQCwYaymMYtkdqkSpyhqnoXzsLJMNAKsSF7sL_--7InqIMl0FB3mNLOYRuxN_5xV9LWRarZBa_2p1U7UkwiGNgYUGW5DIfISquWriGSV86rqlqBd_CCTav46e2WPDsev-b5l5LYf5BXQQE9xR6dlWcEUnIZ36gnA1pGSw3mjg0YP4sVM4fz6GvQHDMVkAeLTMv7oBvskqgD-ksI6z4_AW2lcZg"></td>
    </tr>
    <tr>
        <td>1 zu 0..1</td>
        <td>Eine Person ist gestorben in minimal Null, maximal einem Ort.</td>
        <td><img src="https://mermaid.ink/svg/pako:eNqNkLEKwkAMhl_lyNyCrkfp5CgousktsZfWg_au3KVDKX0Xn8UnM2qLuEky_PnJF5JMUAVLoKFqMaWdwyZiZ_zjriSti1SxC17tT6t3pJjEMLA1oPJcxEbEIbLSqqHEIV7JK-dVWa7Ie_QCTqv5yaIgz47Hb_P8S8ngf5BXQAYdxQ6dlXMEUrIb36gjA1qkpRqHlg0YP0srDhzOo69Acxwog6G3yLQ8AHSNbRK3R38JYa3nJ20xcn4"></td>
    </tr>
    <tr>
        <td>1 zu 0..*</td>
        <td>Eine Person macht Ferien in minimal Null, maximal vielen Orten.</td>
        <td><img src="https://mermaid.ink/svg/pako:eNqNkL0KQjEMhV8lZBQVXYs4OQqKbtIltlELt630poPIfRefxScz_lzETXqG00O-NOkVXfaMBl1DbbsIdCwUbbrfQOVDYSchJ1hu-mzNpdXA4tQijEZqJuPxQP2qCBiI5E4CtTRU9xASzOc9-Hrgg1_78K3ZjJMEuXyLu19Ke_-DPA8OMXKJFLwupRDohHLiyBaNWs8Hqo1YtKnTUqqSt5fk0EipPMR69iT8-QY0B2paTc-Udjn39-4BWmFz8w"></td>
    </tr>
    <tr>
        <td>1 zu 1..*</td>
        <td>Eine Person war bereits in minimal einem, maximal vielen Orten.</td>
        <td><img src="https://mermaid.ink/svg/pako:eNqNT0EKwkAM_MqSo7QFr0vpyaOg6E32ErqpLrS7ZZsipfQvvsWXmWqLeJPMYTLMDMkIZbAEGsoau27n8BqxMf75UALrIpXsglf706odKXYiGNgaUGk6kyzbCD9EVlrdMSrnVVGs_nfvkhpX8YM8J8-Oh695-k1J5T-ReSCBhmKDzsovElJyGN-oIQNaqKUK-5oNGD-JFXsO58GXoDn2lEDfWmRavgddYd2J2qK_hLDu0wtjFnCG"></td>
    </tr>
</table><p>Es ist dabei zu beachten, dass die Leserichtung (<code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> oder <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>) wichtig ist, da keine Aussage über die Kardinalität der Gegenrichtung gemacht wird! Es wird in dem obigen Beispiel also nur eine Aussage gemacht, in wie vielen Orten <em>eine</em> Person war und nicht darüber wie <em>viele</em> Personen in Orten sein können.</p>
</section>
<section id="beispiel-er-konzeptentwurf-fur-geometrieobjekte">
<h2>Beispiel: ER Konzeptentwurf für Geometrieobjekte<a class="headerlink" href="#beispiel-er-konzeptentwurf-fur-geometrieobjekte" title="Link to this heading">¶</a></h2>
<p>Als Entwurfsbeispiel greifen wir auf die im Kapitel <a class="reference internal" href="#7a_Objects.html"><span class="xref myst">Objektorientierung</span></a> behandelten Beispiel der Geometrieobjekte. Wir haben die Klassen <code class="docutils literal notranslate"><span class="pre">Point</span></code>, <code class="docutils literal notranslate"><span class="pre">Line</span></code> und <code class="docutils literal notranslate"><span class="pre">Polygon</span></code> mit den Varianten <code class="docutils literal notranslate"><span class="pre">Triangle</span></code>, <code class="docutils literal notranslate"><span class="pre">Tetragon</span></code> und <code class="docutils literal notranslate"><span class="pre">Pentagon</span></code>.</p>
<p>Der <code class="docutils literal notranslate"><span class="pre">Point</span></code> hat als Attribute die <code class="docutils literal notranslate"><span class="pre">x</span></code> und <code class="docutils literal notranslate"><span class="pre">y</span></code> Koordinaten vom Datentyp <code class="docutils literal notranslate"><span class="pre">float</span></code>, welche beide als <code class="docutils literal notranslate"><span class="pre">public</span></code> gekapselt sind, da mit <code class="docutils literal notranslate"><span class="pre">+</span></code> annotiert. Ferner gibt es unterschiedliche Methoden in <code class="docutils literal notranslate"><span class="pre">Point</span></code>, <code class="docutils literal notranslate"><span class="pre">Line</span></code> und <code class="docutils literal notranslate"><span class="pre">Polygon</span></code> zur Berechnung der Distanz, Fläche und Länge der jeweiligen Objekte.</p>
<p>Im UML Diagramm haben wir dargestellt, dass ein <code class="docutils literal notranslate"><span class="pre">Polygon</span></code> die Aggregations-Assoziation mit der Multiplizität <code class="docutils literal notranslate"><span class="pre">1</span></code> zu <code class="docutils literal notranslate"><span class="pre">3..*</span></code> zur Klasse <code class="docutils literal notranslate"><span class="pre">Point</span></code> hat, also ein Polygon mit mindestens drei Punkten verknüpft ist. Die <code class="docutils literal notranslate"><span class="pre">Line</span></code> ist wiederum assoziiert mit dem Punkt <code class="docutils literal notranslate"><span class="pre">Point</span></code> mit der Multiplizität <code class="docutils literal notranslate"><span class="pre">1</span></code> zu <code class="docutils literal notranslate"><span class="pre">2</span></code>, also sind einer Linie genau zwei Punkte zugeordnet.</p>
<p>Die Klassen <code class="docutils literal notranslate"><span class="pre">Triangle</span></code>, <code class="docutils literal notranslate"><span class="pre">Tetragon</span></code> und <code class="docutils literal notranslate"><span class="pre">Pentagon</span></code> sind Unterklassen von <code class="docutils literal notranslate"><span class="pre">Polygon</span></code>, welche keine weitere Funktionalität hinzufügen.</p>
<center><img src="https://mermaid.ink/svg/pako:eNptUcFqwzAM_RWjU7o1hW03s-OOOxS20zAEEStpwJGDrcBCl3-fkyxlKfFJ7-m9JxldofSWQEPpMMa3BuuArWGV3syos29Yrguj1GPlPIr6vsPDDdsmCnJJ2ew7LPy4DXRD7VndMpMLA2F2-EcURZRQFNlewHvDtHE74loud9p5vjLwbEDluU_VU6pmr1ZpxyBHRWy34pfT6WGjX5fVqpskcZUv7OtPnqvP0CDXjvZaJAEntNM7E8vUgyO0FFpsbDrC_CsDcqGWDOhUWqqwd2LA8Jik2Iv_GLgELaGnI_SdRaG_s4Gu0MXEdshf3q94_AW6H5O5"  width="400"></center><p>Um für diese Objekte ein Datenbankschema zu entwerfen, führen wir sie in ein ER-Diagram über, indem wir die oben dargestellten Konvertierungsregeln anwenden.</p>
<ul class="simple">
<li><p>Wir annotieren die Klassen als erstes mit <code class="docutils literal notranslate"><span class="pre">&lt;&lt;Entity&gt;&gt;</span></code>, um sie als solches zu kennzeichnen.</p></li>
<li><p>Wir entfernen alle Methoden, da ER-Diagramme sie nicht unterstützen.</p></li>
<li><p>Wir entfernen alle Kapselungsannotationen <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code> oder <code class="docutils literal notranslate"><span class="pre">#</span></code> vor Attributen</p></li>
<li><p>Wir fügen Primärschlüssel zu allen Entitäten hinzu</p></li>
<li><p>Wir wandeln die Speziellen Assoziationstypen Aggregation und Composition in einfache Assoziationen um</p></li>
</ul>
<p>Da es in ER-Diagrammen und DBMS keine Vererbung gibt, müssen wir uns überlegen wie wir mit den Unterklassen <code class="docutils literal notranslate"><span class="pre">Triangle</span></code>, <code class="docutils literal notranslate"><span class="pre">Tetragon</span></code> und <code class="docutils literal notranslate"><span class="pre">Pentagon</span></code> verfahren. Eine Möglichkeit wäre es für jede eine neue Entität einzuführen, die genauso wie ein Polygon aufgebaut ist. Das führt aber zu mehreren redundant aufgebauten Tabellen. Dies ist notwendig wenn die Unterklassen eigene Attribute einführen würden. Da sie das allerdings nicht tun, brauchen wir auch auch keine separaten Entitäten, sondern können Sie in der generischen Entität Polygon mit aufnehmen, indem wir das Attribut <code class="docutils literal notranslate"><span class="pre">PolygonType</span></code> einführen, in dem wir speichern können, ob es sich um ein <code class="docutils literal notranslate"><span class="pre">Triangle</span></code>, <code class="docutils literal notranslate"><span class="pre">Tetragon</span></code>, <code class="docutils literal notranslate"><span class="pre">Pentagon</span></code> oder Untertyp handelt.</p>
<p>Wir erhalten den folgenden Konzeptentwurf:</p>
<center><img src="https://mermaid.ink/svg/pako:eNqVUk1rwzAM_StCx9EWxm6m9NTLWA-h62n4osVKZ5bYwZGhofS_7Lfsl83Nx0ZIDysIIz-_Jz0ZnTH3hlFhXlLTbC0dA1XafX9BCmMD52K9g91-xHbWWQaNjxphuRySLLpPAQWNUBA28M4WNpt_SdiZmaDz0svOI9bHes1OrLR_3D6skyufn7eQvYxPl2m9ruMd9TKfzknBPorSk8DpFtjOWvdjanxarR4m4_uyPaaPVRCrIrmT2fgD4y7DneKG5UbC-Hpo61-TuMCKQ0XWpAVIjSCZkw-uWKNKqeGCYikatbtSKYp_bV2OSkLkBcbakPCwMqgKKpuE1uTevB_vlx87g-rt" width="500"></center>
<p>In dem Konzeptentwurf gibt es drei Entitätstypen. Die Entität <code class="docutils literal notranslate"><span class="pre">Point</span></code> besitzt weiterhin <code class="docutils literal notranslate"><span class="pre">x</span></code> und <code class="docutils literal notranslate"><span class="pre">y</span></code>-Koordinate als die Attribute vom Datentyp <code class="docutils literal notranslate"><span class="pre">float</span></code>. Die Entität <code class="docutils literal notranslate"><span class="pre">Line</span></code> besitzt zwei Relationen zu <code class="docutils literal notranslate"><span class="pre">Point</span></code> für den Start-Punkt und End-Punkt. Die Entität <code class="docutils literal notranslate"><span class="pre">Polygon</span></code> hat die Relation mit der Kardinalität <code class="docutils literal notranslate"><span class="pre">1</span></code> zu <code class="docutils literal notranslate"><span class="pre">3..*</span></code> zu Punkt, umfasst also mindestens drei Punkte. Sie hat auch ein neues Attribut <code class="docutils literal notranslate"><span class="pre">PolygonType</span></code> vom Datentyp <code class="docutils literal notranslate"><span class="pre">str</span></code> um den Untertyp zu speichern. Für alle drei Entitäten haben wir einen numerischen Primärschlüssel definiert, da numerische Indexe sind mit am effizientesten sind.</p>
</section>
<section id="normalisierung-von-konzeptentwurfen-zu-logischen-entwurfen">
<h2>Normalisierung von Konzeptentwürfen zu Logischen Entwürfen<a class="headerlink" href="#normalisierung-von-konzeptentwurfen-zu-logischen-entwurfen" title="Link to this heading">¶</a></h2>
<p>Die Normalisierung ist ein wichtiger Schritt im Prozess der Abbildung eines Konzeptionellen Datenmodells auf ein Logisches und Physikalisches Datenmodell. Sie hat den Zweck, Redundanzen (mehrfaches Festhalten des gleichen Sachverhalts) zu minimieren, indem neue Tabellen erzeugt und durch neue Relationen verknüpft werden für</p>
<ul class="simple">
<li><p>komplexe Attribute (Listen, Dictionaries)</p></li>
<li><p>Relationen mit hoher Kardinalität</p></li>
<li><p>Redundante Daten (z.B. Polygontyp)</p></li>
</ul>
<p>Man unterscheidet dabei verschiedene Normalformen mit fortschreitend strengeren Bedingungen an das Datenbankschema:</p>
<ul class="simple">
<li><p>1NF - 1. Normalform: Alle Attributwerte sind atomar - das heißt, dass jede Information innerhalb einer Tabelle eine eigene Tabellenspalte bekommt und zusammenhängende Informationen, wie zum Beispiel die Postleitzahl und der Ort, oder komplexe Attribute wie Listen oder Diktionaries nicht in einer Tabellenspalte gespeichert werden.</p></li>
<li><p>2NF - 2. Normalform: Nicht-Schlüssel Attribute sind von allen Primärschlüsseln voll funktional abhängig - das heißt, dass nur Informationen die funktional zusammen hängen in einer Entität gespeichert werden. Zum Beispiel wird zu einer Rechnung nicht direkt der Name des Kunden gespeichert, sondern diese gehören zu einer separaten Entität Kunde, da ein Kunde ja mehrere Rechnungen haben kann. Wenn man ein ER-Diagramms erstellt und über die Entitäten nachdenkt, so wendet man meist automatisch die 2. Normalform an.</p></li>
<li><p>3NF - 3. Normalform: Nicht-Schlüssel Attribute sind nur von Primärschlüssel abhängig - das heißt, dass redundante Attribute die zusammengehören zusammen abgespeichert werden. So treten Postleitszahlen und Ortsnahmen paarweise auf und sollten eine separate Entität bilden.</p></li>
<li><p>BCNF - Boyce-Codd-Normalform: Alle Attribute von denen Attribute abhängen sind Schlüssel - das heißt, dass wenn mehre Fremdschlüssel in einer Entität auftreten und diese voneinander abhängen, so wird diese Abhängigkeit auch wieder in eine Entität ausgelagert. Speichert man zum Beispiel Ortsnahmen und Postleitzahlen in separaten Entitäten (Weil sich ja Ortsnamen doppeln), so darf man nicht die Fremdschlüssel PLZ und Ortsname in der Kundenentität speichern, sondern braucht immer noch die Entität PLZ-Ortsname.</p></li>
<li><p>4NF - 4. Normalform: Es gibt nur noch triviale mehrwertige Abhängigkeiten - das heißt, dass wenn mehrwertig Attribute mit Fremdschlüssel oder anderen mehrwertigen Attributen auftreten, mit denen sie funktional nichts zu tun haben, so werden diese ausgelagert. Zum Beispiel ist es in der 4NF falsch bei einer Bestellung die Lieferanschrift, Kundennummer und die Artikelnummern in einer Tabelle zu speichern, da die Lieferanschrift mit der Kundennummer zusammenhängt, aber nicht mit den Artikelnummern. Korrekt sind zwei Tabellen mit Lieferanschrift und Kundennummer und eine mit Artikelnummer und Kundennummer.</p></li>
<li><p>5NF - 5. Normalform: Es gibt keine mehrwertigen Abhängigkeiten, die voneinander abhängig sind  - das heißt das jeder Zusammenhang zwischen einem Attributen und Fremdschlüssel in eine eigene Tabelle ausgelagert wird.</p></li>
</ul>
<p>Meistens sind nur die ersten drei Normalformen im Datenbankentwurf relevant. Höhere Normalformen resultieren in sehr vielen kleinteiligen Tabellen, die auch für einfache Anfragen immer durch Joints zusammengesetzt werden müssen, was die Benutzbarkeit drastisch einschränkt.</p>
<p>An unserem Geometrie-Beispiel wollen wir uns einige Beispiele anschauen, für eine Verletzung der 1. bis 3. Normalform.</p>
<p>Im dem folgenden ER-Diagramm verletzen wir die 1. Normalform, da wir ein komplexes Attribut <code class="docutils literal notranslate"><span class="pre">List&lt;Punkt&gt;</span></code> definieren, statt dieses als Relation aufzulösen.</p>
<center><img src="https://mermaid.ink/svg/pako:eNpVjzEOgzAMRa8See4JEGJiqcqA2q3KYiWGRgUHgTMgBGfpWXqyhpYMtb5k--l_yV7AeEuQgelwmkqH7Yi95vdLRVk3khHnWVXXxL4-Vftubj0vif6U58TiZC6Kf-5YUuJcqvqiWR1VuUm2OvBTNjXsjVJy1awZTtDT2KOz8cJlj2mQB_WkIYujpQZDJxo0r9GKQfxtZgOZjIFOEAaLQsdPkDXYTZEOyHfv075-AHfmYNg" width="200"></center><p>Im zweiten ER-Diagramm verletzen wir die 2. Normalform verletzt, da wir die Koordinaten des Start- und End-Punktes direkt in der Linie speichern, obwohl diese Punkte darstellen und somit einen funktionalen Zusammenhang haben. Hier ist die Lösung diese in die Entität <code class="docutils literal notranslate"><span class="pre">Punkt</span></code> auszulagern und Relationen zu erzeugen.</p>
<center><img src="https://mermaid.ink/svg/pako:eNp1kEEKg0AMRa8yZO0JRFy5KXVR2l0ZKMGJ7YBmZMxARbxLz9KTdWxrQbCQRfL-_5BkhMoZghSqBvu-sHj12Gp-PlQsYz1VYh2r8riwt0-Vli2NC_tUlhGLlSHP19yyzH7aFeqwX0t141BUL-jlcv8vDVsSsdnOzMIvMWmGBFryLVoTz4w7K6VBbtSShjS2hmoMjWjQPEUrBnGngStIxQdKIHQGhb6PgbTGpo-0Qz47t8zTCyn2gtQ" width="200"></center>
<p>Im letzten Beispiel speichern wir fehlerhaft das Attribut PolygonTyp in der Entität Punkt, obwohl sie zu der Entität Polygon gehört.</p>
<center><img src="https://mermaid.ink/svg/pako:eNqVUctqwzAQ_JVljyUJLrmJkFMupT2Ypqeii2rJqageRl5BRfC_9Fv6ZV0ci2LopbCI0czuMiNdsYvaoMDOqXE8WXVJysvw_QVc2ibTkY0Bnp4rN_dBm8MHXSt3q8PBBLJUjsc1bwNBG_l8OEH7uNZ6FxXB519kWZMjJd7iyiWGlzJUbapgkUDivUTYbhnsd7s7xrNVEJB9z84Jfu0tUW6T_wozT6zisBGZm6Z5kwE36E3yymp-Vl4L7IXejTcSBUNtepUdSZRh4laVKZ5L6FBQymaDedCKzPIRKHrlRmYHFV5jrPfpB_QlrEw" width="400"></center></section>
<section id="normalisierung-von-kardinalitaten">
<h2>Normalisierung von Kardinalitäten<a class="headerlink" href="#normalisierung-von-kardinalitaten" title="Link to this heading">¶</a></h2>
<p>Entsprechend der 1. Normalform müssen wir Kardinalitäten entsprechend ihrer Ordnung unterschiedlich abbilden. Dabei können einfache Kardinalitäten (0 oder 1) als Attribut gespeichert werden, wärend höhere Kardinalitäten <code class="docutils literal notranslate"><span class="pre">&gt;1</span></code> als Relation in einer neuen Entität abgebildet werden. Hierbei spielt es im Logischen und Physikalischen Entwurf eine Rolle ob ein Attribut beim speichern einer neuen Entität in der Datenbank nicht angegeben werden muss (<code class="docutils literal notranslate"><span class="pre">Nullable</span></code>) oder zwingend angeben werden muss (<code class="docutils literal notranslate"><span class="pre">Not</span> <span class="pre">Null</span></code>).</p>
<table>
    <tr>
        <td style="width: 10%">Kardinalität</td>
        <td style="width: 40%">Beispiel</td>
        <td style="width: 50%">ER-Diagramm</td>
    </tr>
    <tr>
        <td>1 zu 1</td>
        <td>Die Relationen werden durch Fremdschlüssel in der Entität von der die Relation startet `>>` abgebildet. Der Fremdschlüssel ist `Not Null`, also ein Eintrag muss IMMER vorhanden sein.</td>
        <td><img src="https://mermaid.ink/svg/pako:eNp1UMtqQjEQ_ZVh1rpwG8SVCGKx0u5KNtOb0QZyJ5I7WYjcf-m3-GWNmiAihbOYnJxHMmfsomM02AUahqWnQ6LeyuUXCpxP3KmPAm8fjdtxGgphcWYRptM6vCcFAwf-jokFvMBi0Qy34Go7N_KO-ZxFvZ4e4ju8aDWsl7DbvF7WorXAagPbqLDNITTZ-NxcnvZvLbxGF_lT6YgT7Dn15F3ZUkmC8mX94Z4tmjI63lMOatHKVUpZ4-dJOjSaMk8wHx0p172i2VMYCnsk-Yqxncc_DKqVow"></td>
    </tr>
    <tr>
        <td>1 zu 0..1</td>
        <td>Die Relation wird mit Fremdschlüssel in der Entität abgebildet. Der Fremdschlüssel ist `Nullable`, also ein Eintrag muss NICHT vorhanden sein.</td>
        <td><img src="https://mermaid.ink/svg/pako:eNp1UMFqQjEQ_JVlj0WFXoN4koJYWmlvkkt8WW0gbyPJ5iDy_sVv6Zd1W19aRApzmExmZ5I9Y5c8ocEuulKWwR2y6y1_XkDhQ6ZOQmJ4fmvahnJRweKjRZhOv8ls9qD8NQsYOFCRlHfEEBgWizb1kz7Onpt4xXxOLEFOf-YrAss4sFrCZn1_-Vu1Ynhaw0uN0e0iNeNw263P-7cY7sPVflOraTjBnnLvgtd1aRbo3-WDerJolHrauxrFouVBra5Kej9xh0ZypQnWo3dC44LR7F0sqh4db1Nq5-ELDQSZBA" ></td>
    </tr>
    <tr>
        <td>1 zu 0..*</td>
        <td>Die Relation wird als neue Entität mit Fremdschlüssels abgebildet.</td>
        <td><img src="https://mermaid.ink/svg/pako:eNqVUctKA0EQ_JWmz8nB6xICQhAkgkHxInNpd3rdgXmE2Z5DCPsvfotfZrsPkhg9CH2oqX5U9fQR62QZK6w9dd3G0XumYOLnB2hYl7kWlyI8PM3cUAc7zl2Kx5kcY7XiKE4O6_Ul76JMDfcb2G3nZD-DMQcGbwzCcjmB29LouJa8MFQ6GwLVrUDJnsrbpZvHLH9agWsvWv67kXPJH260R124CKflRu2znn98x7DLy7AK3G2v8yp0ontcYOAcyFk9lKqAmpKWAxusFFpuqHgxaOJ3KRVJz4dYYyW58ALL3pLwdFqsGvKdsnuKrynN7_4L_TzJhQ"></td>
    </tr>
    <tr>
        <td>1 zu 1..*</td>
        <td>Die Relation wird als neue Entität mit Fremdschlüssels abgebildet. Mindestens ein Eintrag sollte vorhanden sein (Das ist eine Konsistenzregel, die sich in einer DBMS nicht erzwingen lässt (es gibt sonst ein Henne-Ei-Problem).).</td>
        <td><img src="https://mermaid.ink/svg/pako:eNqVkc1qwzAMx19F6NweejWlMCiF0cHKdhu-iFhZDYldHPlQSt5lz7Inq2jiNl23w8AH-a-vn6QTVtExGqwa6rq1p89ErQ3fX6DP-cSV-Bjg5a1olzjYcepiOBVxeMslB_FyXK3udR9kTHhew25bnH0xBh9YXFiE-Xw0nnKt5fbUCIPR2kBX4Z7lNcmfIPBIouG_Y0wb_mDRHGXwAW6jDb0nOf9Yxm0S2Gwf3dpnM8XDGbacWvJO76RtQKlkzy1bNGo6rinrUtCGXkMpS3w_hgqNpMwzzAdHwuNl0dTUdKoeKHzEWP79GZXPyXc"></td>
    </tr>
</table></section>
<section id="beispiel-geometrie">
<h2>Beispiel Geometrie<a class="headerlink" href="#beispiel-geometrie" title="Link to this heading">¶</a></h2>
<p>Um den oben erstellten Konzeptentwurf für die Geometrieobjekte in ein Logischen Entwurf zu überführen, müssen wir den Entwurf normalisieren. Schauen wir uns den Entwurf noch einmal an.</p>
<center><img src="https://mermaid.ink/svg/pako:eNqVUk1rwzAM_StCx9EWxm6m9NTLWA-h62n4osVKZ5bYwZGhofS_7Lfsl83Nx0ZIDysIIz-_Jz0ZnTH3hlFhXlLTbC0dA1XafX9BCmMD52K9g91-xHbWWQaNjxphuRySLLpPAQWNUBA28M4WNpt_SdiZmaDz0svOI9bHes1OrLR_3D6skyufn7eQvYxPl2m9ruMd9TKfzknBPorSk8DpFtjOWvdjanxarR4m4_uyPaaPVRCrIrmT2fgD4y7DneKG5UbC-Hpo61-TuMCKQ0XWpAVIjSCZkw-uWKNKqeGCYikatbtSKYp_bV2OSkLkBcbakPCwMqgKKpuE1uTevB_vlx87g-rt" width="500"></center><p>Wir haben die drei Entitäten <code class="docutils literal notranslate"><span class="pre">Linie</span></code>, <code class="docutils literal notranslate"><span class="pre">Punkt</span></code> und <code class="docutils literal notranslate"><span class="pre">Polygon</span></code> mit zwei 1:1-Relationen von <code class="docutils literal notranslate"><span class="pre">Linie</span></code> zu <code class="docutils literal notranslate"><span class="pre">Punkt</span></code> und einer 1:3..*-Relationen von <code class="docutils literal notranslate"><span class="pre">Polygon</span></code> zu <code class="docutils literal notranslate"><span class="pre">Punkt</span></code>.</p>
<p>Wenden wir zuerst die Regeln der 1NF an und lösen diese Relationen auf entsprechend der oben gennanten Tabelle, so können wir die zwei 1:1-Relationen von <code class="docutils literal notranslate"><span class="pre">Linie</span></code> zu <code class="docutils literal notranslate"><span class="pre">Punkt</span></code> durch Fremdschlüssel in der Entität <code class="docutils literal notranslate"><span class="pre">Linie</span></code> darstellen.</p>
<p>Die 1:3..*-Relationen von <code class="docutils literal notranslate"><span class="pre">Polygon</span></code> zu <code class="docutils literal notranslate"><span class="pre">Punkt</span></code> hingegen ist entsprechend der 1NF nicht direkt abbildbar, da wir eine Multiplizität größer 1 haben und wir müssen eine neue Entität einführen. Diese Entität (Tabelle) listet welche Polygone, welche Punkte benutzen. Die neue Entität enthät also die zwei Fremdschlüssel und einen neuen Primärschlüssel. Im Logischen Entwurf führen wir auch die Fremdschlüssel als Attribut mit auf, um diese Eindeutig mit darzustellen.</p>
<center><img src="https://mermaid.ink/svg/pako:eNqVk0FqwzAQRa8yaJ0sujUmq7RQEoJJuireqNY4FZUlI49KTchdepaerLIVNzi22xoGIc38j56k0YllRiCLWKZ4Va0lP1pepPrrE3wIaTEjaTRs911uK7VESNldymC5vEwSp98IIqiIW0IBLyhhtfqXBbUYGFqWYDt1uRBxjJok1VdtCKmp0ePjGpLNsHRouMKODxvYGdo5pYayey2mROc-WyubwZYYP47A5cpwgo9xpFCs_0Ixqj4aPQumdYzgVGS76lNdTm4cLun2QYOvraF_2DgGV-SekH5sPcW43Rvf_XjbCz3rjKPuUfGmgSf64noTv7VF93gjXcEWrEBbcCn8F_Jc4E9Dr1hgyiI_FZhzpyhlqW6k3JE51DpjEVmHC-ZKwQkvn45FOVeVz5ZcPxvTrc_fQ2JraQ"></center><p>In diesem Entwurf ist die 2NF und 3NF ist breits erfüllt.</p>
<p>Allerdings haben wir viele Dopplungen (Redundanzen) bei dem Attribut <code class="docutils literal notranslate"><span class="pre">PolygonTyp</span></code>, welche ja nur die Werte <code class="docutils literal notranslate"><span class="pre">Triangle</span></code>, <code class="docutils literal notranslate"><span class="pre">Tetragon</span></code> und <code class="docutils literal notranslate"><span class="pre">Pentagon</span></code> annehmen kann, aber jedes mal als neuer String gespeichert werden muss. Gleichzeitig wollen wir ja auch, dass dieses Attribut nur diese Werte annimmt und nicht mit Kauderwelsch gefüllt wird. Deshalb ist es sinnvoll hier die Werte zu begrenzen und die Dopplung von Strings zu vermeiden indem wir eine neue Entität <code class="docutils literal notranslate"><span class="pre">PolygonType</span></code> einführen. Diese definiert die Grundtypen <code class="docutils literal notranslate"><span class="pre">Triangle</span></code>, <code class="docutils literal notranslate"><span class="pre">Tetragon</span></code> und <code class="docutils literal notranslate"><span class="pre">Pentagon</span></code> und weißt ihnen einen numerischen Primärschlüssel zu, den wir in der Entität <code class="docutils literal notranslate"><span class="pre">Polygon</span></code> als Fremdschlüssel referenzieren.</p>
<p>Zu guter letzt definieren wir noch für alle Attribute und Fremdschlüssel ob sie <code class="docutils literal notranslate"><span class="pre">Nullable</span></code> oder <code class="docutils literal notranslate"><span class="pre">NotNull</span></code> sind.</p>
<p>Wir erhalten den finalen Logischen Entwurf:</p>
<center><img src="https://mermaid.ink/svg/pako:eNqVVEFugzAQ_MrK5-TQK0I5pZWqRBFKeqp8cfGSWDV2BOuqKOIvfUtfVoMhVQKhDbIs450RM7M2J5ZaiSxiqRZluVRiX4icm-8v8EOqAlNS1sB62--tlVEInD1wBvN5t0iceSeIoCRREEp4QwWLxb8oaOSA0GoJtFO_F0YcoyFF1S82DGWowePzEpLVsLRrdIUvPq1gY2njtB7CHo28BaovtbWwO7Ql1s8j4jJtBcHnuKRQrP6SYnW1t-YuMS3jRlZd9aU6esBEECGp664GcltD3904BpdnXiadaReIcbonfvj5-kBcUCf8Qvc0braoRXOCp82OOh12byqNc2pobrvycRx8S0dttdT7uxj6dO2tpAI2IscRvWzGcixyoaS_9acmLc7ogDlyFvmlxEw4TZxxU3uocGR3lUlZRIXDGXNHKQi7_0S_eRTm1Vr_mgldYv0DvTmt6A"></center><p>Wichtig zu erkennen in dem logischen Entwurf ist, dass wir jetzt nur noch 1:1-Relationen haben, also alle höherwertigen Kardinalitäten aufgelößt haben. Zusätzlich haben wir Redundanzen aufgelößt und haben jetzt ein sehr effizienten Datenbankentwurf.</p>
<p>Im Physikalischen Entwurf würde man diesem Entwurf jetzt noch weitere Informationen hinzufügen, wie zum Beispiel zusätzliche Zugangangsbeschränkungen oder Abfrageindizies. Zugangsbeschränkungen gibt es in den meisten DBMS nur auf Entitätsebene und nicht auf Attributsebene (wie in UML), man kann also Beschränken welche Nutzer, welche Tabellen sehen, lesen, erzeugen, oder verändern können, aber nicht welche Spalten sie sehen.</p>
<p>Beim Entwurf von Abfrageindizies ist die Regel, dass man versucht alle häufig genutzten <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Bedingungen, die man in <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>-Anfragen in SQL benutzt, durch entsprechende Indizies beschleunigt werden.</p>
<p>Damit sind wir auch schon direkt im SQL Thema wo wir uns mit der Erzeugung von Tabellen beschäftigen wollen.</p>
</section>
<section id="tabellen-mit-sql-implementieren">
<h2>Tabellen mit SQL implementieren<a class="headerlink" href="#tabellen-mit-sql-implementieren" title="Link to this heading">¶</a></h2>
<p>SQL erlaubt es uns nicht nur Daten aus bestehenden Tabellen abzufragen, sondern auch neue Tabellen zu erzeugen und diese zu verändern. Wir wollen diese Funktionalität im folgenden nutzen, um unseren Logischen Entwurf für die Geometrieobjekte zu implementieren.</p>
<p>Hierfür nutzen wir wieder SQLite und erzeugen uns eine neue Datenbank <code class="docutils literal notranslate"><span class="pre">geometry.sqlite</span></code>. Wir setzten uns auch direkt einen Kursor <code class="docutils literal notranslate"><span class="pre">cur</span></code>, um SQL Befehle auf der Datenbank auszuführen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

<span class="c1"># Create a SQL connection to our SQLite database</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;geometry.sqlite&quot;</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Als erstes müssen wir die generischen Datentypen des logischen Entwurfs auf die konkreten Datentypen von SQLite abbilden. Grundsätzlich unterscheiden die Datentypen sich für jedes DBMS etwas und man muss immer schauen, welche Datentypen am besten geeignet ist. SQLite beschränkt sich auf relativ wenige Datentypen, welche gut mit den primitiven Datentypen von Python überein stimmen. Die folgende Tabelle vergleicht die Datentypen von SQLite mit Python.</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>SQLite</p></th>
<th class="head"><p>Python</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Boolean</p></td>
<td><p>(INTEGER)</p></td>
<td><p>bool</p></td>
</tr>
<tr class="row-odd"><td><p>Ganzzahl</p></td>
<td><p>INTEGER</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-even"><td><p>Gleitkommazahl</p></td>
<td><p>REAL</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>Interpretiert beliebige Dateneingaben als Zahl</p></td>
<td><p>NUMERIC</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>Text-String, gespeichert in UTF-8 oder UTF-16</p></td>
<td><p>TEXT</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-odd"><td><p>Beliebiger Block an Binärdaten</p></td>
<td><p>BLOB</p></td>
<td><p>bytes</p></td>
</tr>
<tr class="row-even"><td><p>Keine Daten</p></td>
<td><p>NULL</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
</div>
<p>Besonderheit hier ist der <code class="docutils literal notranslate"><span class="pre">NUMERIC</span></code> Datentyp, welcher dazu da ist, dass Zahlen aus Texteingaben automatisch in die passende Zahlenrepräsentation in der Datenbank umgewandelt wird. Der <code class="docutils literal notranslate"><span class="pre">NULL</span></code> Wert ist in der Tabelle kein Datentyp an sich sondern wird benutzt beim Laden von Daten in Tabellen fehlende Werte zu übertragen.</p>
<p>Mit diesen Datentypen und dem ER-Diagramm des Logischen Entwurfsmodells oben können wir jetzt unsere Tabellen erzeugen. Dies geschieht in SQL mit dem <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> Befehl auf welchen der Tabellenname (Entitätsname) folgt und dann in Klammern, die einzelnen Attribute. Für die fünf Entitäten ergeben sich die folgenden SQL Befehle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">CREATE TABLE Points (</span>
<span class="s1">  point_id INTEGER,</span>
<span class="s1">  x REAL,</span>
<span class="s1">  y REAL</span>
<span class="s1">);</span>

<span class="s1">CREATE TABLE Lines (</span>
<span class="s1">  lines_id INTEGER,</span>
<span class="s1">  start INTEGER,</span>
<span class="s1">  end INTEGER</span>
<span class="s1">);</span>

<span class="s1">CREATE TABLE PolygonTypes (</span>
<span class="s1">  polygontype_id INTEGER,</span>
<span class="s1">  name TEXT</span>
<span class="s1">);</span>

<span class="s1">CREATE TABLE Polygons (</span>
<span class="s1">  polygon_id INTEGER,</span>
<span class="s1">  polygontype INTEGER</span>
<span class="s1">);</span>

<span class="s1">CREATE TABLE PolygonPoints (</span>
<span class="s1">  polypoint_id INTEGER,</span>
<span class="s1">  polygon_id INTEGER,</span>
<span class="s1">  point_id INTEGER</span>
<span class="s1">);</span>
<span class="s1">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Prinzipiell könnten wir diese Befehle bereits an die SQLite DB senden und die Tabellen anlegen. Allerdings fehlen hier noch die Deklarierung der Primär- und Fremdschlüssel sowie die <code class="docutils literal notranslate"><span class="pre">Not</span> <span class="pre">Null</span></code> Constraints.</p>
<p>Hierfür ergänzen wir die Zeilen der Attribute welche als Primärschlüssel dienen mit der Anmerkung <code class="docutils literal notranslate"><span class="pre">PRIMARY</span> <span class="pre">KEY</span></code>. In unserm Beispiel definieren wir den Schlüssel als <code class="docutils literal notranslate"><span class="pre">AUTOINCREMENT</span></code>, das heißt, dass neuen Daten die ohne Schlüssel hinzugefügt werden, automatisch ein Schlüssel zugewiesen wird.</p>
<p>Die Fremdschlüssel definieren wir als zusätzlichen Constraint (Bedingung) indem wir angeben welche Attribute Fremdschlüssel sind und auf welche Tabelle und Schlüsselattribute diese sich beziehen. Der Fremdschlüssel <code class="docutils literal notranslate"><span class="pre">polytype</span></code> in der Tabelle <code class="docutils literal notranslate"><span class="pre">Polygons</span></code> verweißt zum Beispiel auf den Primärschlüssel <code class="docutils literal notranslate"><span class="pre">polytype_id</span></code> in der Tabelle <code class="docutils literal notranslate"><span class="pre">PolygonTypes</span></code>. Mehrfachnennungen sind hier möglich wie das Beispiel für den <code class="docutils literal notranslate"><span class="pre">start</span></code> und <code class="docutils literal notranslate"><span class="pre">end</span></code> Point in der Tabelle <code class="docutils literal notranslate"><span class="pre">Lines</span></code> zeigt.</p>
<p>Wir annotieren weiterhin alle Attribute und Fremdschlüssel die nicht Null sein dürfen mit <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">NULL</span></code>. Primärschlüssel dürfen nie null sein, weshalb wir diese Annotation nicht brauchen.</p>
<p>Damit ergibt sich unser vervollständigtes SQL-Skript zum Erzeugen aller Tabellen zu:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">CREATE TABLE Points (</span>
<span class="s1">  point_id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">  x REAL NOT NULL,</span>
<span class="s1">  y REAL NOT NULL</span>
<span class="s1">);</span>

<span class="s1">CREATE TABLE Lines (</span>
<span class="s1">  lines_id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">  start INTEGER NOT NULL,</span>
<span class="s1">  end INTEGER NOT NULL,</span>
<span class="s1">  FOREIGN KEY(start,end) REFERENCES Points(point_id,point_id)</span>
<span class="s1">);</span>

<span class="s1">CREATE TABLE PolygonTypes (</span>
<span class="s1">  polytype_id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">  name TEXT</span>
<span class="s1">);</span>

<span class="s1">CREATE TABLE Polygons (</span>
<span class="s1">  polygon_id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">  polytype INTEGER,</span>
<span class="s1">  FOREIGN KEY(polytype) REFERENCES PolygonTypes(polytype_id)</span>
<span class="s1">);</span>

<span class="s1">CREATE TABLE PolygonPoints (</span>
<span class="s1">  polypoint_id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s1">  polygon_id INTEGER,</span>
<span class="s1">  point_id INTEGER,</span>
<span class="s1">  FOREIGN KEY(polygon_id) REFERENCES Polygons(polygon_id),</span>
<span class="s1">  FOREIGN KEY(point_id) REFERENCES Points(point_id)</span>
<span class="s1">);</span>
<span class="s1">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Da dieses SQL-Script mehrere Befehle enthält, können wir es nicht mit <code class="docutils literal notranslate"><span class="pre">cur.execute(sql)</span></code> an die Datenbank senden, sondern benutzen</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Um zu prüfen ob unsere Tabellen angelegt worden sind, können wir alle Tabellen in der SQLite Datebank abfragen mit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;SELECT name FROM sqlite_schema WHERE type=&#39;table&#39; ORDER BY name;&quot;</span>

<span class="n">rows</span><span class="o">=</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Lines&#39;,)
(&#39;Points&#39;,)
(&#39;PolygonPoints&#39;,)
(&#39;PolygonTypes&#39;,)
(&#39;Polygons&#39;,)
(&#39;sqlite_sequence&#39;,)
</pre></div>
</div>
</div>
</div>
</section>
<section id="daten-hinzufugen">
<h2>Daten hinzufügen<a class="headerlink" href="#daten-hinzufugen" title="Link to this heading">¶</a></h2>
<p>Im nächsten Schritt wollen wir einige Werte in die Datenbank laden. Dies geschieht mit dem SQL Befehl <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span></code> mit dem Tabellennamen und den einzutragenden Werten, in genau der Reihenfolge der vorher deklarierten Spalten (also point_id, x, y).</p>
<p>Zum Beispiel wollen wir zwei Punkte mit den Koordinaten (54.083336, 12.108811) und (12.094167, 54.075211). Dabei geben wir auch den Wert des Primärindex als 1 und 2 mit an:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">INSERT INTO Points VALUES(1, 54.083336, 12.108811);</span>
<span class="s2">INSERT INTO Points VALUES(2, 12.094167, 54.075211);</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Dieser Primärindex muss einmalig sein. Wollen wir zum Beispiel die gleichen Punkte noch einmal erzeugen, so gibt uns die Datenbank eine Fehlermeldung zurück, dass die Punkte schon existieren.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IntegrityError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

<span class="ne">IntegrityError</span>: UNIQUE constraint failed: Points.point_id
</pre></div>
</div>
</div>
</div>
<p>Wollen wir von der Spaltenreihenfolge abweichen oder Werte weglassen. So können wir die zu schreibenden Spaltennamen am <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> Befehl auch mit angeben. Lassen wir eine Spalte weg, so wird sie mit <code class="docutils literal notranslate"><span class="pre">NULL</span></code> beschrieben, sofern die Spalte Nullwerte erlaubt. Da wir bei der Tabellendeklaration den Primärschlüssel <code class="docutils literal notranslate"><span class="pre">point_id</span></code> als <code class="docutils literal notranslate"><span class="pre">AUTOINCREMENT</span></code> deklariert haben, müssen wir diesen nicht unbedingt mit angeben. Ihm wird dann automatisch ein Wert zugewiesen.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;INSERT INTO Points(x, y) VALUES(54.083336, 12.108811);&quot;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Hier haben wir allerdings das Problem, dass wir den Wert nicht kennen und somit auch später als Fremdschlüssel nicht weiter verwenden können. In Python wird dieser im Cursor gespeichert unter</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<p>Als nächstes wollen wir eine Linie zwischen dem Punkt (54.083336, 12.108811) und (12.094167, 54.075211) erzeugen. Dies können wir nicht direkt mit den Koordinaten, sondern müssen die Fremdschlüssel der Punkte nutzen, welche wir beim erzeugen zugewiesen haben. Also 1 und 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;INSERT INTO Lines(start, end) VALUES(1, 2);&quot;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<p>Bevor wir ein Polygon erzeugen können müssen wir erst den Polygontyp in der Tabelle <code class="docutils literal notranslate"><span class="pre">PolygonTypes</span></code> deklarieren. Zum Beispiel sagen wir, dass es den Polygontyp “Dreieck” gibt mit dem Primärschlüsselwert 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s1">&#39;INSERT INTO PolygonTypes VALUES(0, &quot;Dreieck&quot;);&#39;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>Jetzt erzeugen wir den Eintrag für das Polygon in der Tabelle <code class="docutils literal notranslate"><span class="pre">Polygon</span></code>. Hier gibt es nur den Primärschlüssel, z.B. 33 und den Fremdschlüssel 0 für den Polygontyp.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s1">&#39;INSERT INTO Polygons VALUES(33, 0);&#39;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>33
</pre></div>
</div>
</div>
</div>
<p>Wollen wir zum Beispiel ein Polygon für einen nicht existenten Polygontypen mit dem Fremdschlüssel 6 erzeugen, so gibt uns die Datenbank eine Fehlermeldung zurück.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s1">&#39;INSERT INTO Polygons VALUES(66, 6);&#39;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>66
</pre></div>
</div>
</div>
</div>
<p>Hier sieht man die Datenbank die Integrität der Daten absichert und uns vor der Eingabe falscher Daten abhält.</p>
<p>Allerdings ist unser Polygon noch nicht fertig definiert und wir müssen noch die dem Polygon zugehörigen Punkte verknüpfen. Dies machen wir durch drei Eintragungen in der Tabelle <code class="docutils literal notranslate"><span class="pre">PolygonPoints</span></code> unter Angabe der neuen Primärschlüssel (331, 332, 333), des Fremdschlüssel für das Polygon 33 und der Fremdschlüssel für die drei Punkte (1,2,3).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;INSERT INTO PolygonPoints VALUES(331, 33, 1);</span>
<span class="s2">INSERT INTO PolygonPoints VALUES(332, 33, 2);</span>
<span class="s2">INSERT INTO PolygonPoints VALUES(333, 33, 3);</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>66
</pre></div>
</div>
</div>
</div>
</section>
<section id="daten-loschen">
<h2>Daten löschen<a class="headerlink" href="#daten-loschen" title="Link to this heading">¶</a></h2>
<p>Um Einträge aus einer Tabelle zu löschen verwendet man in SQL den <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span></code> Befehl mit der Tabelle und einer <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Bedingung, welche angibt welche Einträge zu löschen sind. Wollen wir zum Beispiel die eben verknüpften Punkte aus der Tabelle <code class="docutils literal notranslate"><span class="pre">PolygonPoints</span></code> wieder löschen so können wir schreiben, dass wir alle Zeilen löschen, wo die refernzierte Polygon die <code class="docutils literal notranslate"><span class="pre">polygon_id</span></code> 33 hat.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;DELETE FROM PolygonPoints WHERE polygon_id=33;&quot;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span> <span class="c1"># gibt uns die zuletzt gelöschte Zeile zurück</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>333
</pre></div>
</div>
</div>
</div>
</section>
<section id="tabellen-umbenennen-und-verandern">
<h2>Tabellen umbenennen und verändern<a class="headerlink" href="#tabellen-umbenennen-und-verandern" title="Link to this heading">¶</a></h2>
<p>Machmal ist es notwendig Tabellen zu sichern oder SQL Abfragen mit SQL Select zu “materialisieren”, also als neue Tabelle zu speichern. Dafür können wir den <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">...</span> <span class="pre">AS</span></code> mit einem <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> benutzen. Dies ist sinnvoll um zum Beispiel eine Kopie einer Tabelle zu erzeugen, bevor man z.B. Änderungen vornimmt. Man beachte</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;CREATE TABLE PointsCopy AS SELECT * FROM Points;&quot;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Möchte man eine Tabelle umbennenen so nutzt man dafür den <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">...</span> <span class="pre">RENAME</span></code> Befehl in SQL. Um die Tabelle <code class="docutils literal notranslate"><span class="pre">Points</span></code> nach <code class="docutils literal notranslate"><span class="pre">Punkte</span></code> umzubenennen, schreiben wir</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;ALTER TABLE Points RENAME TO Punkte;&quot;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Auf ähnliche Weise können wir auch Spalten in Tabellen umbenennen oder neue Spalten hinzufügen. Wollen wir zum Beispiel beim Polygontypen eine neue Spalte hinzufügen, welche die maximale Anzahl an Punkten enthält so geschieht dies wie folgt:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;ALTER TABLE PolygonTypes ADD COLUMN maxPoints INTEGER DEFAULT 0;&quot;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Es ist zu beachten, dass dies die Spalte zwar anlegt aber keine Werte schreibt. Deshalb weisen wir hier der Spalten den Standartwert 0 mit <code class="docutils literal notranslate"><span class="pre">DEFAULT</span> <span class="pre">0</span></code> zu.</p>
</section>
<section id="tabellen-loschen">
<h2>Tabellen löschen<a class="headerlink" href="#tabellen-loschen" title="Link to this heading">¶</a></h2>
<p>SQL bietet natürlich auch einen Befehl um Tabellen vollständig zu löschen. Möchte man nur alle Daten aus einer Tabelle löschen aber die Definition der Tabelle behalten (wenn man zum Beispiel die Daten austauscht), so kann man den <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span></code> ohne <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Bedingung nutzen. Dies nennt man auch Truncating einer Tabelle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s2">&quot;DELETE FROM PointsCopy;&quot;</span>
<span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sqlite3.Cursor at 0x7f99306dd940&gt;
</pre></div>
</div>
</div>
</div>
<p>Möchte man eine Tabelle vollständig löschen so nutzt man den <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span></code> Befehl. Hier nutzen wir den optionalen Zusatz <code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">EXISTS</span></code> um sicherzustellen, das die Tabelle nur gelöscht wird, wenn sie existiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">DROP TABLE IF EXISTS PointsCopy;</span>
<span class="s1">DROP TABLE IF EXISTS Punkte;</span>
<span class="s1">DROP TABLE IF EXISTS Lines;</span>
<span class="s1">DROP TABLE IF EXISTS PolygonTypes;</span>
<span class="s1">DROP TABLE IF EXISTS Polygons;</span>
<span class="s1">DROP TABLE IF EXISTS PolygonPoints;</span>
<span class="s1">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Damit haben wir die Exkursion in SQL zum Umgang mit Datenbanken abgeschlossen. Zuletzt müssen wir die Verbindung zur Datenbank noch mit <code class="docutils literal notranslate"><span class="pre">close()</span></code> schließen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="anmerkung-zu-tabellen-in-sqlite-speichern-mit-pandas">
<h2>Anmerkung zu Tabellen in SQLite speichern mit Pandas<a class="headerlink" href="#anmerkung-zu-tabellen-in-sqlite-speichern-mit-pandas" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In der letzten Übung haben wir Tabellen direkt mit Pandas in SQLite erzeugt. Das ist durchaus sinnvoll, wenn man größere Datensätze mal schnell sicher in einer Datenbank speichern möchte. Es ist aber darauf hinzuweisen, dass die von Pandas erzeugten Tabellen keine Relationen mit Fremdschlüssel, Constraints (z.B. NotNull) oder Suchindizies definieren. Die resultierenden Tabellen sind also keinesfalls 3NF-Konform und optimiert für die Abfrage und das speichern großer Datenmengen in praktischen Anwendungen. Hier ist immer zu empfehlen einen richtigen ER-Entwurf zu machen. Die Tabellen mit <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> mit allen Relationen, Constraints und Indizies zu erzeugen und dann erst mit Pandas Daten in die bestehenden Tabellen zu laden.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="10_Datenbanken.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Relationale Datenbanken</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; CC-BY-NC-SA 2022
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Entwurf relationaler Datenbanken</a><ul>
<li><a class="reference internal" href="#entwurfsvorgehen">Entwurfsvorgehen</a></li>
<li><a class="reference internal" href="#er-diagramme">ER-Diagramme</a></li>
<li><a class="reference internal" href="#kardinalitaten">Kardinalitäten</a></li>
<li><a class="reference internal" href="#beispiel-er-konzeptentwurf-fur-geometrieobjekte">Beispiel: ER Konzeptentwurf für Geometrieobjekte</a></li>
<li><a class="reference internal" href="#normalisierung-von-konzeptentwurfen-zu-logischen-entwurfen">Normalisierung von Konzeptentwürfen zu Logischen Entwürfen</a></li>
<li><a class="reference internal" href="#normalisierung-von-kardinalitaten">Normalisierung von Kardinalitäten</a></li>
<li><a class="reference internal" href="#beispiel-geometrie">Beispiel Geometrie</a></li>
<li><a class="reference internal" href="#tabellen-mit-sql-implementieren">Tabellen mit SQL implementieren</a></li>
<li><a class="reference internal" href="#daten-hinzufugen">Daten hinzufügen</a></li>
<li><a class="reference internal" href="#daten-loschen">Daten löschen</a></li>
<li><a class="reference internal" href="#tabellen-umbenennen-und-verandern">Tabellen umbenennen und verändern</a></li>
<li><a class="reference internal" href="#tabellen-loschen">Tabellen löschen</a></li>
<li><a class="reference internal" href="#anmerkung-zu-tabellen-in-sqlite-speichern-mit-pandas">Anmerkung zu Tabellen in SQLite speichern mit Pandas</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script src="https://cdn.jsdelivr.net/gh/bonartm/quizdown-js@latest/public/build/quizdown.js"></script>
    <script>quizdown.init({"start_on_load": true, "shuffle_answers": true, "shuffle_questions": false, "primary_color": "#FF851B", "secondary_color": "#DDDDDD", "text_color": "black", "locale": "de", "quizdown_js": "https://cdn.jsdelivr.net/gh/bonartm/quizdown-js@latest/public/build/quizdown.js"});</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>